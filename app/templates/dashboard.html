<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</head>
<body>
    <div class="dashboard-container">

        <!-- 🏠 SIDEBAR -->
        <aside class="sidebar">
            <h3>Bienvenido, {{ current_user.username }}</h3>

            <!-- 📌 Menú de Navegación -->
            <nav class="nav-menu">
                <a href="{{ url_for('main.dashboard') }}" class="nav-btn active">📌 Lotes</a>
                <a href="{{ url_for('main.historial') }}" class="nav-btn">📜 Historial</a>
            </nav>

            <!-- 🎯 Filtros -->
            <div class="filters">
                <h4>📊 Filtrar por Estado</h4>
                <label><input type="checkbox" class="filter" data-filter="estado" value="completado"> ✅ Completo</label>
                <label><input type="checkbox" class="filter" data-filter="estado" value="pendiente"> ⏳ Pendiente</label>
                <label><input type="checkbox" class="filter" data-filter="estado" value="atrasado"> ❌ Atrasado</label>

                <h4>🌍 Filtrar por Fundo</h4>
                <label><input type="checkbox" class="filter" data-filter="fundo" value="Jayanca"> 🌿 Jayanca</label>
                <label><input type="checkbox" class="filter" data-filter="fundo" value="La Esperanza"> 🌿 La Esperanza</label>

                <h4>🍃 Filtrar por Cultivo</h4>
                <label><input type="checkbox" class="filter" data-filter="cultivo" value="Arandano"> 🍇 Arándano</label>
                <label><input type="checkbox" class="filter" data-filter="cultivo" value="Esparrago"> 🥦 Espárrago</label>
            </div>

            <a href="{{ url_for('auth.logout') }}" class="btn-salir">Salir</a>
        </aside>

        <!-- 🔹 CONTENIDO PRINCIPAL -->
        <main class="main-content">
            <header class="header-dashboard">
                <h2>🌾 Lotes Registrados</h2>
                {% if current_user.role == 'admin' %}
                    <a href="{{ url_for('main.agregar_lote') }}" class="btn-agregar">Agregar Lote</a>
                {% endif %}
            </header>

            <!-- 📦 GALERÍA DE LOTES -->
            <section class="contenedor-lotes">
                <div class="lotes-grid">
                    {% for lote in lotes %}
                    <div class="lote-card" 
     data-estado="{{ lote.estado.lower() }}" 
     data-fundo="{{ lote.fundo_rel.nombre.lower() }}" 
     data-cultivo="{{ lote.cultivo_rel.nombre.lower() }}">

    <a href="{{ url_for('main.detalle_lote', id_lote=lote.id) }}" class="lote-card-link"></a>

    <div class="lote-header">
        <span class="estado-lote">
            {% if lote.estado.strip().lower() == 'pendiente' %}
                🟡
            {% elif lote.estado.strip().lower() == 'completado' %}
                🟢
            {% elif lote.estado.strip().lower() == 'atrasado' %}
                🔴
            {% endif %}
        </span>       
        <h3 class="lote-nombre">Lote <strong>{{ lote.nombre }}</strong></h3>
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('main.editar_lote', lote_id=lote.id) }}" class="editar-lote">
            ✏️
        </a>
        {% endif %}
    </div>

    <div class="lote-info">
        <p class="ubicacion">📍 {{ lote.fundo_rel.nombre }}</p>
        <p>🌱 <strong>Cultivo:</strong> {{ lote.cultivo_rel.nombre }}</p>
        <p>🧪 <strong>Químicos:</strong> {{ lote.quimicos_pendientes }}</p>
        <p class="dias-restantes">
            {% if lote.dias_restantes == "N/A" %}
                <span class="dias-na">🚫 N/A</span>
            {% else %}
                ⏳ {{ lote.dias_restantes }} días
            {% endif %}
        </p>
    </div>
</div>


                    {% endfor %}
                </div>
            </section>
        </main>
    </div>
</body>
</html>

