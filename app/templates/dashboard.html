<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</head>
<body>
    <div class="dashboard-container">

        <!-- ğŸ  SIDEBAR -->
        <aside class="sidebar">
            <h3>Bienvenido, {{ current_user.username }}</h3>

            <!-- ğŸ“Œ MenÃº de NavegaciÃ³n -->
            <nav class="nav-menu">
                <a href="{{ url_for('main.dashboard') }}" class="nav-btn active">ğŸ“Œ Lotes</a>
                <a href="{{ url_for('main.historial') }}" class="nav-btn">ğŸ“œ Historial</a>
            </nav>

            <!-- ğŸ¯ Filtros -->
            <div class="filters">
                <h4>ğŸ“Š Filtrar por Estado</h4>
                <label><input type="checkbox" class="filter" data-filter="estado" value="completado"> âœ… Completo</label>
                <label><input type="checkbox" class="filter" data-filter="estado" value="pendiente"> â³ Pendiente</label>
                <label><input type="checkbox" class="filter" data-filter="estado" value="atrasado"> âŒ Atrasado</label>

                <h4>ğŸŒ Filtrar por Fundo</h4>
                <label><input type="checkbox" class="filter" data-filter="fundo" value="Jayanca"> ğŸŒ¿ Jayanca</label>
                <label><input type="checkbox" class="filter" data-filter="fundo" value="La Esperanza"> ğŸŒ¿ La Esperanza</label>

                <h4>ğŸƒ Filtrar por Cultivo</h4>
                <label><input type="checkbox" class="filter" data-filter="cultivo" value="Arandano"> ğŸ‡ ArÃ¡ndano</label>
                <label><input type="checkbox" class="filter" data-filter="cultivo" value="Esparrago"> ğŸ¥¦ EspÃ¡rrago</label>
            </div>

            <a href="{{ url_for('auth.logout') }}" class="btn-salir">Salir</a>
        </aside>

        <!-- ğŸ”¹ CONTENIDO PRINCIPAL -->
        <main class="main-content">
            <header class="header-dashboard">
                <h2>ğŸŒ¾ Lotes Registrados</h2>
                {% if current_user.role == 'admin' %}
                    <a href="{{ url_for('main.agregar_lote') }}" class="btn-agregar">Agregar Lote</a>
                {% endif %}
            </header>

            <!-- ğŸ“¦ GALERÃA DE LOTES -->
            <section class="contenedor-lotes">
                <div class="lotes-grid">
                    {% for lote in lotes %}
                    <div class="lote-card" 
     data-estado="{{ lote.estado.lower() }}" 
     data-fundo="{{ lote.fundo_rel.nombre.lower() }}" 
     data-cultivo="{{ lote.cultivo_rel.nombre.lower() }}">

    <a href="{{ url_for('main.detalle_lote', id_lote=lote.id) }}" class="lote-card-link"></a>

    <div class="lote-header">
        <span class="estado-lote">
            {% if lote.estado.strip().lower() == 'pendiente' %}
                ğŸŸ¡
            {% elif lote.estado.strip().lower() == 'completado' %}
                ğŸŸ¢
            {% elif lote.estado.strip().lower() == 'atrasado' %}
                ğŸ”´
            {% endif %}
        </span>       
        <h3 class="lote-nombre">Lote <strong>{{ lote.nombre }}</strong></h3>
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('main.editar_lote', lote_id=lote.id) }}" class="editar-lote">
            âœï¸
        </a>
        {% endif %}
    </div>

    <div class="lote-info">
        <p class="ubicacion">ğŸ“ {{ lote.fundo_rel.nombre }}</p>
        <p>ğŸŒ± <strong>Cultivo:</strong> {{ lote.cultivo_rel.nombre }}</p>
        <p>ğŸ§ª <strong>QuÃ­micos:</strong> {{ lote.quimicos_pendientes }}</p>
        <p class="dias-restantes">
            {% if lote.dias_restantes == "N/A" %}
                <span class="dias-na">ğŸš« N/A</span>
            {% else %}
                â³ {{ lote.dias_restantes }} dÃ­as
            {% endif %}
        </p>
    </div>
</div>


                    {% endfor %}
                </div>
            </section>
        </main>
    </div>
</body>
</html>

